<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- SEO Metadata -->
<meta content="Rod WoMAX's Automation Suite customizes solutions to eliminate tedious manual work. Years of expertise in media, marketing, business, and coding make life easier and complete." name="description"/>
<meta content="automation, Rod WoMAX, business automation, media solutions, marketing automation, coding automation, streamline processes, complete life, productivity tools" name="keywords"/>
<meta content="Rod WoMAX Automation Suite" name="author"/>
<meta content="Rod WoMAX Automation Suite - Complete Your Life with Automation" property="og:title"/>
<meta content="Eliminate tedious manual processes. Automate your business and life with customized solutions by Rod WoMAX." property="og:description"/>
<meta content="media/WoMacroMAXAutomation-logo-00.png" property="og:image"/>
<meta content="website" property="og:type"/>
<meta content="https://www.yourwebsite.com" property="og:url"/>
<title>Rod WoMAX Automation Suite | Make Life Complete</title>
<link href="media/WoMacroMAXAutomation-logo-00.png" rel="icon" type="image/png"/>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

<style>
  /* GENERAL RESET */
  html, body {
    margin: 0; padding: 0; width: 100%; height: 100%;
    overflow-x: hidden; font-family: Arial, sans-serif; background-color: #f8f9fa;
  }

  /* TITLE BAR with sprayed gradient */
  .title-bar {
    position: fixed; top: 0; left: 0; right: 0;
    background: linear-gradient(to bottom, #ffc107 30%, #ffffff 100%);
    border-radius: 0 0 50px 50px; padding: 20px 15px 10px;
    display: flex; flex-direction: column; align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,.1); z-index: 3000;
  }
  .title-bar h1 { margin: 0; font-weight: bold; font-size: clamp(1.5rem, 5vw, 2rem); color: black; white-space: nowrap; text-align: center; transition: font-size .3s ease; }
  .title-bar h1 span.red { color: red; }

  /* SOCIAL ICONS including red email */
  .social-icons { margin-top: 8px; font-size: 1.5rem; }
  .social-icons a { margin: 0 8px; transition: transform .3s ease; }
  .social-icons a:hover { transform: scale(1.2); }
  .fa-facebook { color: #3b5998; } .fa-twitter { color: #1da1f2; } .fa-linkedin { color: #0077b5; } .fa-whatsapp { color: #25d366; } .fa-envelope { color: #ff0000; }

  /* PORTFOLIO BUTTON */
  .portfolio-button {
    position: fixed; top: calc(50% + 40px); left: 20px; transform: translateY(-50%);
    width: 70px; height: 70px; background-color: #fdd663; color: #444; font-size: .75rem; font-weight: bold; border: none; border-radius: 50%;
    cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,.2); opacity: .8; z-index: 3100; transition: transform .2s ease, opacity .3s ease;
    display: flex; align-items: center; justify-content: center; text-align: center; line-height: 1.1; padding: 8px;
  }
  .portfolio-button:hover { opacity: 1; transform: translateY(-50%) scale(1.05); }
  @media (max-width: 500px) { .portfolio-button { left: 50%; transform: translate(-50%, -50%); } }

  /* LOGO section */
  .logo-container img { width: 100%; max-width: 950px; opacity: .75; display: block; margin: 0 auto; transition: all .3s ease; height: auto; object-fit: cover; }
  @media (max-width: 300px) { .logo-container { padding-top: 96px; } }

  /* OVERLAY (shared for panels/iframe) */
  #overlay { position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 3500; display: none; opacity: 0; transition: opacity .5s ease; }
  #overlay.show { display: block; opacity: 1; }

  /* PANELS */
  .panel { position: fixed; inset: 0; background: #fff; z-index: 4000; display: none; flex-direction: column; overflow-y: auto; }
  .panel.show { display: flex; animation: fadeInDown .7s ease forwards; }
  @keyframes fadeInDown { 0% { opacity: 0; transform: translateY(-50px); } 100% { opacity: 1; transform: translateY(0); } }
  .panel-header { position: sticky; top: 0; background: #fff; padding: 15px; text-align: center; font-weight: bold; font-size: 2rem; z-index: 10; border-bottom: 1px solid #ddd; }
  .panel-content { padding: 20px; animation: fallDown .8s ease both; }
  @keyframes fallDown { from { opacity: 0; transform: translateY(-20px);} to { opacity: 1; transform: translateY(0);} }
  .close-btn { position: sticky; top: 10px; right: 10px; margin-left: auto; background: none; border: none; font-size: 2rem; font-weight: bold; color: #000; cursor: pointer; z-index: 11; }

  /* PORTFOLIO CARD GRID (existing) */
  .card-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 20px; padding: 10px; justify-items: stretch; align-items: stretch; }
  .card { width: 100%; height: 340px; border-radius: 15px; overflow: hidden; transition: transform .4s ease; display: flex; flex-direction: column; border: 2px solid #ffc107; background-color: #fffbe6; }
  .card:hover { transform: scale(1.05) translateY(-5px); }
  .card img { width: auto; max-width: 100%; height: 120px; object-fit: contain; margin: 10px auto; display: block; }
  .card-body { background: #fff; padding: 10px; }
  .seo-blurb { font-size: .8rem; color: #6c757d; margin-top: 5px; }
  .card h5, .card p { color: #333 !important; }
  .portfolio-link { cursor: pointer; }
  @media (max-width: 1200px) { .card-grid { grid-template-columns: repeat(3,1fr); } }
  @media (max-width: 900px)  { .card-grid { grid-template-columns: repeat(2,1fr); } }
  @media (max-width: 600px)  { .card-grid { grid-template-columns: 1fr; } }

  /* MARKETING WRITE-UP */
  .marketing-section { padding: 40px 20px; max-width: 800px; margin: 0 auto; text-align: center; position: relative; overflow: hidden; }
  .marketing-section h2 { font-size: 2rem; margin-bottom: 20px; color: #333; }
  .marketing-section p { font-size: 1.1rem; line-height: 1.7; color: #555; }
  .marketing-section::before {
    content: ""; position: absolute; top: 3in; left: 50%; transform: translateX(-50%);
    width: 400px; height: 400px; background: url('https://womacromax.com/media/WoMacroMAXAutomation-logo-00.png') no-repeat center / contain; opacity: .2; z-index: 0;
  }
  .marketing-section h2, .marketing-section div { position: relative; z-index: 1; }

  /* ====== 3D CAROUSEL (namespaced to avoid .card conflicts) ====== */
  .c3d-wrap { padding-top: 120px; } /* space under fixed title bar */
  .c3d-header { text-align: center; margin: 40px 0 24px; }
  .c3d-subtitle {
    color: #ff6b35; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 12px;
  }
  .c3d-title { font-size: clamp(36px, 5vw, 56px); font-weight: 900; color: #0a0a0a; line-height: 1.1; margin: 0; }

  .c3d-container {
    perspective: 1500px; perspective-origin: 50% 50%; cursor: grab; width: 100%; max-width: 1400px; overflow: hidden; margin-inline: auto;
  }
  .c3d-container.dragging { cursor: grabbing; }
  .c3d-track { display: flex; align-items: center; justify-content: center; gap: 8px; transform-style: preserve-3d; }

  .c3d-card {
    flex-shrink: 0; width: 240px; background: #fff; overflow: hidden; transform-style: preserve-3d; position: relative; cursor: pointer;
  }
  .c3d-card::before {
    content: ""; position: absolute; inset: 0;
    background: linear-gradient(to right, rgba(0,0,0,.15), transparent 30%, transparent 70%, rgba(0,0,0,.15));
    transform: translateZ(-8px); pointer-events: none;
  }
  .c3d-card::after {
    content: ""; position: absolute; inset: 0; background: #e0e0e0; transform: translateZ(-16px); box-shadow: 0 0 40px rgba(0,0,0,.3); pointer-events: none;
  }
  .c3d-card img { width: 100%; height: 100%; object-fit: cover; display: block; position: relative; z-index: 1; pointer-events: none; }
  .c3d-card .hover-overlay {
    position: absolute; inset: 0; background: rgba(0,0,0,.7); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity .3s ease; z-index: 2;
  }
  .c3d-card:hover .hover-overlay { opacity: 1; }
  .c3d-card .hover-overlay span { color: #fff; font-size: 16px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

  .c3d-track.blurred .c3d-card:not(.expanded) { filter: blur(8px); transition: filter .6s ease; }
  .c3d-card.expanded { z-index: 1000 !important; }

  .c3d-info {
    position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
    text-align: center; opacity: 0; pointer-events: none; transition: opacity .6s ease;
    z-index: 3600; /* above overlay (3500) but below panels (4000) */
    max-width: 600px; min-width: 320px; padding: 1.5rem; background: #ff6b35; box-shadow: 4px 3px 18px 4px #b7b7b721; border-radius: 10px;
  }
  .c3d-info.visible { opacity: 1; pointer-events: all; }
  .c3d-info h2 { font-size: 32px; font-weight: 900; color: #0a0a0a; margin-bottom: 10px; }
  .c3d-info p { font-size: 18px; color: #080808; line-height: 1.6; margin: 0; }

  .c3d-close {
    position: fixed; top: 100px; right: 24px; width: 56px; height: 56px;
    background: #fff; border: none; border-radius: 50%; display: flex; align-items: center; justify-content: center;
    cursor: pointer; z-index: 3601; opacity: 0; pointer-events: none; transition: all .3s ease; box-shadow: 0 8px 25px rgba(0,0,0,.2);
  }
  .c3d-close.visible { opacity: 1; pointer-events: all; }
  .c3d-close:hover { background: #ff6b35; color: #fff; transform: rotate(90deg) scale(1.08); }
  .c3d-close svg { width: 24px; height: 24px; }
</style>
</head>

<body>
<!-- TITLE BAR -->
<section class="title-bar">
  <h1>WoMacro<span class="red">MAX</span> Automation</h1>
  <div class="social-icons">
    <a href="#"><i class="fab fa-facebook"></i></a>
    <a href="#"><i class="fab fa-twitter"></i></a>
    <a href="#"><i class="fab fa-linkedin"></i></a>
    <a href="#"><i class="fab fa-whatsapp"></i></a>
    <a href="#" id="emailIcon"><i class="fas fa-envelope"></i></a>
  </div>
  <button class="portfolio-button" id="openPortfolioBtn">Portfolio</button>
</section>

<!-- LOGO -->
<section class="logo-container" style="padding-top:130px;">
  <img alt="WoMacroMAX Automation Logo" src="media/WoMacroMAXAutomation-logo-00.png"/>
</section>

<!-- ===== 3D CAROUSEL SECTION ===== -->
<section class="c3d-wrap container">
  <div class="c3d-header">
    <p class="c3d-subtitle">Behind creativity</p>
    <h2 class="c3d-title">Curious what else we've created?</h2>
  </div>

  <div class="c3d-container" id="c3dContainer" aria-roledescription="carousel">
    <div class="c3d-track" id="c3dTrack">
      <!-- Cards -->
      <div class="c3d-card" data-title="Beverage Branding" data-desc="Fresh and vibrant packaging design for premium juice products with natural ingredients">
        <img src="https://images.unsplash.com/photo-1546548970-71785318a17b?w=600&h=800&fit=crop" alt="Beverage Branding">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
      <div class="c3d-card" data-title="Apparel Design" data-desc="Minimalist fashion collection with sustainable materials and modern aesthetics">
        <img src="https://images.unsplash.com/photo-1581578731548-c64695cc6952?w=600&h=800&fit=crop" alt="Apparel Design">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
      <div class="c3d-card" data-title="Luxury Packaging" data-desc="Premium product packaging with attention to detail and sophisticated finishes">
        <img src="https://images.unsplash.com/photo-1559056199-641a0ac8b55e?w=600&h=800&fit=crop" alt="Luxury Packaging">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
      <div class="c3d-card" data-title="Cosmetics Brand" data-desc="Clean beauty brand identity with elegant and timeless design approach">
        <img src="https://images.unsplash.com/photo-1598440947619-2c35fc9aa908?w=600&h=800&fit=crop" alt="Cosmetics Brand">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
      <div class="c3d-card" data-title="Fashion Editorial" data-desc="Editorial photography and art direction for contemporary fashion magazine">
        <img src="https://images.unsplash.com/photo-1556228578-8c89e6adf883?w=600&h=800&fit=crop" alt="Fashion Editorial">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
      <div class="c3d-card" data-title="Botanical Series" data-desc="Natural product line with organic ingredients and eco-friendly packaging">
        <img src="https://images.unsplash.com/photo-1611930022073-b7a4ba5fcccd?w=600&h=800&fit=crop" alt="Botanical Series">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
      <div class="c3d-card" data-title="Product Photography" data-desc="Professional product photography with creative lighting and composition">
        <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=600&h=800&fit=crop" alt="Product Photography">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
      <div class="c3d-card" data-title="Streetwear Brand" data-desc="Urban fashion line with bold graphics and contemporary street style">
        <img src="https://images.unsplash.com/photo-1523381210434-271e8be1f52b?w=600&h=800&fit=crop" alt="Streetwear Brand">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
      <div class="c3d-card" data-title="Tech Accessories" data-desc="Minimalist tech product design with user-centered functionality">
        <img src="https://images.unsplash.com/photo-1583743814966-8936f5b7be1a?w=600&h=800&fit=crop" alt="Tech Accessories">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
      <div class="c3d-card" data-title="Wellness Products" data-desc="Holistic wellness brand with natural and calming visual identity">
        <img src="https://images.unsplash.com/photo-1610701596007-11502861dcfa?w=600&h=800&fit=crop" alt="Wellness Products">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
      <div class="c3d-card" data-title="Home Decor" data-desc="Contemporary home accessories with Scandinavian design influence">
        <img src="https://images.unsplash.com/photo-1564584217132-2271feaeb3c5?w=600&h=800&fit=crop" alt="Home Decor">
        <div class="hover-overlay"><span>Click to see more</span></div>
      </div>
    </div>
  </div>

  <!-- Floating details + close -->
  <button class="c3d-close" id="c3dClose" aria-label="Close expanded card">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" />
    </svg>
  </button>

  <div class="c3d-info" id="c3dInfo" aria-live="polite">
    <h2 id="c3dTitle"></h2>
    <p id="c3dDesc"></p>
  </div>
</section>
<!-- ===== /3D CAROUSEL ===== -->

<!-- OVERLAY (shared) -->
<div id="overlay"></div>

<!-- PORTFOLIO PANEL -->
<section class="panel" id="portfolioPanel">
  <button class="close-btn" id="closePortfolioBtn">×</button>
  <div class="panel-header">Portfolio</div>
  <div class="panel-content">
    <div class="card-grid">
      <!-- CARD 1 -->
      <div class="card bg-primary text-white portfolio-link" data-link="https://www.healthequityimpact.com">
        <img alt="Health Equity Impact" src="https://womacromax.github.io/HEI/media/Health%20Equity%20Impact%20LOGO.png"/>
        <div class="card-body">
          <h5 class="card-title">Health Equity Impact</h5>
          <p class="seo-blurb">Advancing community wellness through research, advocacy, and innovative solutions that promote health equity across diverse populations.</p>
        </div>
      </div>
      <!-- CARD 2 -->
      <div class="card bg-success text-white portfolio-link" data-link="https://www.communityfamilyclinic.com">
        <img alt="Community Family Clinic" src="https://communityfamilyclinic.com/media/CFC-Icon-House-People-2.png"/>
        <div class="card-body">
          <h5 class="card-title">Community Family Clinic</h5>
          <p class="seo-blurb">Delivering compassionate, affordable healthcare services to families, with a focus on primary care, wellness, and preventive medicine.</p>
        </div>
      </div>
      <!-- CARD 3 -->
      <div class="card bg-warning text-white portfolio-link" data-link="https://residentservices.womacromax.com">
        <img alt="Resident Services Portal" src="https://womacromax.github.io/HEI/Test/flyers/modals/images/image-woman-helping-couple.png"/>
        <div class="card-body">
          <h5 class="card-title">Resident Services Portal</h5>
          <p class="seo-blurb">Empowering residents with streamlined access to assistance programs, maintenance requests, and vital community support services.</p>
        </div>
      </div>
      <!-- CARD 4 -->
      <div class="card bg-danger text-white portfolio-link" data-link="https://dynamicchoice.womacromax.com">
        <img alt="Dynamic Choice Platform" src="https://dynamicchoice.womacromax.com/media/Dynamic_Choice_Salon_Natural_Hair_Oil_Ad.PNG"/>
        <div class="card-body">
          <h5 class="card-title">Dynamic Choice Platform</h5>
          <p class="seo-blurb">Optimizing service selection and personalized options for clients, driving flexible, user-centered decision-making solutions online.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- EMAIL PANEL -->
<section class="panel" id="emailPanel">
  <button class="close-btn" id="closeEmailBtn">×</button>
  <div class="panel-header">Send an Email</div>
  <div class="panel-content">
    <div class="email-form">
      <form>
        <input class="form-control" placeholder="Your Name" required type="text"/>
        <input class="form-control" placeholder="Your Email" required type="email"/>
        <input class="form-control" placeholder="Subject" required type="text"/>
        <textarea class="form-control" placeholder="Your Message" required rows="5"></textarea>
        <button class="btn btn-warning w-100 mt-3" type="submit">Send Email</button>
      </form>
    </div>
  </div>
</section>

<!-- MARKETING WRITE-UP -->
<section class="marketing-section" id="marketingSection" style="padding-top: 2in;">
  <h2>Rod WoMAX’s Automation Suite: Tailored Solutions for a Complete Life</h2>
  <div style="text-align: justify; text-align-last: left; line-height: 1.5; margin-top: -10px;">
    <p>Rod WoMAX’s Automation Suite is uniquely crafted to suit your business and personal needs. With years of hands-on experience in media, marketing, business operations, and coding, Rod brings a deep understanding of how technology should work for you, not against you.</p>
    <p>Our solutions eliminate tedious manual processes, streamline procedures, and create seamless workflows that allow you to focus on what truly matters.</p>
    <p>Imagine reclaiming your time and energy — automation transforms busy work into joyful productivity!</p>
    <p>Whether you're a growing business, a startup, or just someone who values efficiency, the WoMAX Automation Suite is designed to be your personal toolkit for a smarter, easier, and COMPLETE digital life.</p>
    <p>From powerful media integration to customized marketing automations, business management, and coding optimizations — Rod WoMAX makes automation approachable, effective, and exciting.</p>
    <p><strong>Experience the JOY of automation. Make life easier. Get COMPLETE with WoMAX.</strong></p>
  </div>
</section>

<!-- IFRAME PREVIEW PANEL -->
<section class="panel" id="iframePanel">
  <button class="close-btn" id="closeIframeBtn">×</button>
  <div class="panel-header">Preview</div>
  <div class="panel-content">
    <iframe id="iframeViewer" src="" style="width:100%; height:80vh; border:none;"></iframe>
  </div>
</section>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- GSAP for carousel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<script>
  /* ===== Existing UI logic (panels & overlay) ===== */
  const openPortfolioBtn = document.getElementById('openPortfolioBtn');
  const portfolioPanel = document.getElementById('portfolioPanel');
  const emailPanel = document.getElementById('emailPanel');
  const closePortfolioBtn = document.getElementById('closePortfolioBtn');
  const closeEmailBtn = document.getElementById('closeEmailBtn');
  const overlay = document.getElementById('overlay');
  const emailIcon = document.getElementById('emailIcon');

  emailIcon.addEventListener('click', (e) => {
    e.preventDefault();
    portfolioPanel.classList.remove('show');
    emailPanel.classList.add('show');
    overlay.classList.add('show');
  });

  openPortfolioBtn.addEventListener('click', () => {
    emailPanel.classList.remove('show');
    portfolioPanel.classList.toggle('show');
    overlay.classList.toggle('show', portfolioPanel.classList.contains('show'));
  });

  closePortfolioBtn.addEventListener('click', () => {
    portfolioPanel.classList.remove('show');
    overlay.classList.remove('show');
  });

  closeEmailBtn.addEventListener('click', () => {
    emailPanel.classList.remove('show');
    overlay.classList.remove('show');
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === "Escape") {
      portfolioPanel.classList.remove('show');
      emailPanel.classList.remove('show');
      iframePanel.classList.remove('show');
      overlay.classList.remove('show');
      iframeViewer.src = "";
    }
  });

  // IFRAME viewer behavior
  const iframePanel = document.getElementById('iframePanel');
  const iframeViewer = document.getElementById('iframeViewer');
  const closeIframeBtn = document.getElementById('closeIframeBtn');

  document.querySelectorAll('.portfolio-link').forEach(card => {
    card.addEventListener('click', () => {
      const link = card.getAttribute('data-link');
      iframeViewer.src = link;
      portfolioPanel.classList.remove('show');
      emailPanel.classList.remove('show');
      iframePanel.classList.add('show');
      overlay.classList.add('show');
    });
  });

  closeIframeBtn.addEventListener('click', () => {
    iframePanel.classList.remove('show');
    overlay.classList.remove('show');
    iframeViewer.src = "";
  });

  /* ===== 3D Carousel logic (namespaced) ===== */
  const positions = [
    { height: 620, z: 220, rotateY: 48,  y: 0, clip: "polygon(0px 0px, 100% 10%, 100% 90%, 0px 100%)" },
    { height: 580, z: 165, rotateY: 35,  y: 0, clip: "polygon(0px 0px, 100% 8%, 100% 92%, 0px 100%)" },
    { height: 495, z: 110, rotateY: 15,  y: 0, clip: "polygon(0px 0px, 100% 7%, 100% 93%, 0px 100%)" },
    { height: 420, z: 66,  rotateY: 15,  y: 0, clip: "polygon(0px 0px, 100% 7%, 100% 93%, 0px 100%)" },
    { height: 353, z: 46,  rotateY: 6,   y: 0, clip: "polygon(0px 0px, 100% 7%, 100% 93%, 0px 100%)" },
    { height: 310, z: 0,   rotateY: 0,   y: 0, clip: "polygon(0 0, 100% 0, 100% 100%, 0 100%)" },
    { height: 353, z: 54,  rotateY: 348, y: 0, clip: "polygon(0px 7%, 100% 0px, 100% 100%, 0px 93%)" },
    { height: 420, z: 89,  rotateY: -15, y: 0, clip: "polygon(0px 7%, 100% 0px, 100% 100%, 0px 93%)" },
    { height: 495, z: 135, rotateY: -15, y: 1, clip: "polygon(0px 7%, 100% 0px, 100% 100%, 0px 93%)" },
    { height: 580, z: 195, rotateY: 325, y: 0, clip: "polygon(0px 8%, 100% 0px, 100% 100%, 0px 92%)" },
    { height: 620, z: 240, rotateY: 312, y: 0, clip: "polygon(0px 10%, 100% 0px, 100% 100%, 0px 90%)" }
  ];

  class Carousel3D {
    constructor() {
      this.container = document.getElementById("c3dContainer");
      this.track = document.getElementById("c3dTrack");
      this.cards = Array.from(document.querySelectorAll(".c3d-card"));
      this.totalCards = this.cards.length;
      this.isDragging = false;
      this.startX = 0;
      this.dragDistance = 0;
      this.threshold = 60;
      this.processedSteps = 0;
      this.expandedCard = null;
      this.info = document.getElementById("c3dInfo");
      this.title = document.getElementById("c3dTitle");
      this.desc = document.getElementById("c3dDesc");
      this.closeBtn = document.getElementById("c3dClose");
      this.init();
    }
    init(){ this.applyPositions(); this.attachEvents(); }
    applyPositions(){
      this.cards.forEach((card, index) => {
        const pos = positions[index];
        gsap.set(card, {
          height: pos.height,
          clipPath: pos.clip,
          transform: `translateZ(${pos.z}px) rotateY(${pos.rotateY}deg) translateY(${pos.y}px)`
        });
      });
    }
    expandCard(card){
      if (this.expandedCard) return;
      this.expandedCard = card;
      this.title.textContent = card.dataset.title;
      this.desc.textContent = card.dataset.desc;

      const rect = card.getBoundingClientRect();
      const clone = card.cloneNode(true);
      const overlayEl = clone.querySelector(".hover-overlay");
      if (overlayEl) overlayEl.remove();

      Object.assign(clone.style, {
        position: "fixed", left: rect.left + "px", top: rect.top + "px",
        width: rect.width + "px", height: rect.height + "px", margin: "0", zIndex: "3602"
      });
      clone.classList.add("clone");
      document.body.appendChild(clone);
      this.cardClone = clone;

      gsap.set(card, { opacity: 0 });
      this.track.classList.add("blurred");

      const maxHeight = window.innerHeight * 0.8;
      const finalWidth = Math.min(540, window.innerWidth - 40);
      const finalHeight = Math.min(650, maxHeight);
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;

      gsap.to(clone, {
        width: finalWidth,
        height: finalHeight,
        left: centerX - finalWidth / 2,
        top: centerY - finalHeight / 2,
        clipPath: "polygon(0 0, 100% 0, 100% 100%, 0 100%)",
        transform: "translateZ(0) rotateY(0deg)",
        duration: 0.8, ease: "power2.out",
        onComplete: () => {
          this.info.classList.add("visible");
          this.closeBtn.classList.add("visible");
          this.closeBtn.focus();
        }
      });
    }
    closeCard(){
      if (!this.expandedCard) return;
      this.info.classList.remove("visible");
      this.closeBtn.classList.remove("visible");

      const card = this.expandedCard;
      const clone = this.cardClone;
      const rect = card.getBoundingClientRect();
      const index = this.cards.indexOf(card);
      const pos = positions[index];

      gsap.to(clone, {
        width: rect.width, height: rect.height, left: rect.left, top: rect.top, clipPath: pos.clip,
        duration: 0.8, ease: "power2.out",
        onComplete: () => {
          clone.remove();
          gsap.set(card, { opacity: 1 });
          this.track.classList.remove("blurred");
          this.expandedCard = null;
          this.cardClone = null;
          this.container.focus?.({preventScroll:true});
        }
      });
    }
    rotate(direction){
      if (this.expandedCard) return;
      this.cards.forEach((card, index) => {
        const newIndex = (direction === "next")
          ? (index - 1 + this.totalCards) % this.totalCards
          : (index + 1) % this.totalCards;
        const pos = positions[newIndex];
        gsap.set(card, { clipPath: pos.clip });
        gsap.to(card, { height: pos.height, duration: .5, ease: "power2.out" });
        gsap.to(card, {
          transform: `translateZ(${pos.z}px) rotateY(${pos.rotateY}deg) translateY(${pos.y}px)`,
          duration: .5, ease: "power2.out"
        });
      });
      if (direction === "next"){
        const first = this.cards.shift();
        this.cards.push(first);
        this.track.appendChild(first);
      } else {
        const last = this.cards.pop();
        this.cards.unshift(last);
        this.track.prepend(last);
      }
    }
    attachEvents(){
      this.cards.forEach(card => {
        card.addEventListener("click", () => {
          if (!this.isDragging && !this.expandedCard) this.expandCard(card);
        });
      });
      this.closeBtn.addEventListener("click", () => this.closeCard());

      this.container.addEventListener("mousedown", (e)=>this.handleDragStart(e));
      this.container.addEventListener("touchstart", (e)=>this.handleDragStart(e), {passive:false});
      document.addEventListener("mousemove", (e)=>this.handleDragMove(e));
      document.addEventListener("touchmove", (e)=>this.handleDragMove(e), {passive:false});
      document.addEventListener("mouseup", ()=>this.handleDragEnd());
      document.addEventListener("touchend", ()=>this.handleDragEnd());

      document.addEventListener("keydown", (e)=>{
        if (e.key === "Escape" && this.expandedCard) this.closeCard();
        else if (e.key === "ArrowLeft" && !this.expandedCard) this.rotate("prev");
        else if (e.key === "ArrowRight" && !this.expandedCard) this.rotate("next");
      });
    }
    handleDragStart(e){
      if (this.expandedCard) return;
      this.isDragging = true;
      this.container.classList.add("dragging");
      this.startX = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX;
      this.dragDistance = 0; this.processedSteps = 0;
    }
    handleDragMove(e){
      if (!this.isDragging) return;
      e.preventDefault();
      const currentX = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX;
      this.dragDistance = currentX - this.startX;
      const steps = Math.floor(Math.abs(this.dragDistance) / this.threshold);
      if (steps > this.processedSteps){
        const dir = this.dragDistance > 0 ? "prev" : "next";
        this.rotate(dir);
        this.processedSteps = steps;
      }
    }
    handleDragEnd(){
      if (!this.isDragging) return;
      this.isDragging = false;
      this.container.classList.remove("dragging");
    }
  }

  document.addEventListener("DOMContentLoaded", () => { new Carousel3D(); });
</script>
</body>
</html>
